<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Exatta Contabilidade Digital</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">

    
</head>
<body>

    <nav class="navbar navbar-expand navbar-exatta">
        <div class="container-fluid px-4">
            <a class="navbar-brand" href="#">
            
                <div class="logo-text"><span>e</span>xatta</div>
                <div style="font-size: 12px; color: #ccc; margin-top: -5px;">Contabilidade Digital</div>
            </a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Emitir Nota</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#">Fechamento</a>
                    </li>
                </ul>
            </div>
            <div>
                <a href="#" class="text-white me-3"><i class="far fa-heart"></i></a>
                <a href="#" class="text-white me-3"><i class="far fa-bell"></i></a>
                <a href="#" class="text-white me-3"><i class="far fa-question-circle"></i></a>
                <a href="#" class="text-white"><i class="fas fa-user-circle"></i></a>
            </div>
        </div>
    </nav>
    
    <div class="teste">
        <!-- Navbar -->
        

        <!-- Conteúdo -->
        <div class="container-fluid mt-4">
            <h1>Fechamento</h1>
            <div class="d-flex justify-content-between mb-4">
                <button class="actions-btn">
                    <i class="fas fa-pencil-alt me-2"></i> Ações
                </button>

                <form method="get" id="filtros-form">
                    <div class="filter-container">
                        <div>
                            <select class="form-select filter-select" name="empresa" onchange="this.form.submit()">
                                <option value="">Todas</option>
                                {% for empresa_nome in lista_empresas %}
                                    <option value="{{ empresa_nome }}" {% if request.args.get('empresa') == empresa_nome %}selected{% endif %}>{{ empresa_nome }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <select class="form-select filter-select" name="debito" onchange="this.form.submit()">
                                <option value="">Débito</option>
                                <option value="Sim" {% if request.args.get('debito')=='Sim' %}selected{% endif %}>Sim</option>
                                <option value="Não" {% if request.args.get('debito')=='Não' %}selected{% endif %}>Não</option>
                            </select>
                        </div>
                        <div>
                            <select class="form-select filter-select" name="omisso" onchange="this.form.submit()">
                                <option value="">Omissão</option>
                                <option value="Sim" {% if request.args.get('omisso')=='Sim' %}selected{% endif %}>Sim</option>
                                <option value="Não" {% if request.args.get('omisso')=='Não' %}selected{% endif %}>Não</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Tabela -->
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th style="width: 50px;">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="selectAll">
                                    
                                </div>
                            </th>
                            <th>Empresa</th>
                            <th>CNPJ</th>
                            <th>Débito</th>
                            <th>Omissão</th>
                            <th style="width: 80px;">Ação</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for empresa in empresas %}
                            <tr data-cnpj="{{ empresa.cnpj }}">
                                <td><input class="form-check-input" type="checkbox"></td>
                                <td>{{ empresa.nome }}</td>
                                <td>{{ empresa.cnpj }}</td>
                                <td>
                                    {% if empresa.debito == 'Sim' %}
                                        <span class="badge bg-danger">sim</span>
                                    {% else %}
                                        <span class="badge bg-success">não</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if empresa.omisso == 'Sim' %}
                                        <span class="badge bg-danger">sim</span>
                                    {% else %}
                                        <span class="badge bg-success">não</span>
                                    {% endif %}
                                </td>
                                
                                <td class="text-center">
                                    <a href="#" class="action-icon" data-cnpj="{{ empresa.cnpj }}" onclick="abrirModal(this)">
                                        <i class="fas fa-pencil-alt"></i>
                                    </a>
                                </td>
                            </tr>
                        {% else %}
                            <tr>
                                <td colspan="7" class="text-center text-muted">Nenhum registro encontrado.</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

    
        <!-- Modal de Encerramento de Movimento -->
        <div class="modal fade" id="encerramentoModal" tabindex="-1" aria-labelledby="encerramentoModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="encerramentoModalLabel">Encerrar Movimento</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                    </div>
                    <div class="modal-body">
                        <form id="encerramentoForm">
                            <input type="hidden" id="cnpjEmpresa" name="cnpj">
                            
                            <!-- Período Inicial -->
                            <div class="mb-3">
                                <label for="periodoInicial" class="form-label">Período Inicial (mm/aaaa)</label>
                                <input type="text" class="form-control" id="periodoInicial" name="periodo_inicial" required maxlength="7" placeholder="MM/AAAA">
                                <div class="invalid-feedback">Formato inválido. Use MM/AAAA</div>
                            </div>
                            
                            <!-- Período Final -->
                            <div class="mb-3">
                                <label for="periodoFinal" class="form-label">Período Final (mm/aaaa)</label>
                                <input type="text" class="form-control" id="periodoFinal" name="periodo_final" required maxlength="7" placeholder="MM/AAAA">
                                <div class="invalid-feedback">Formato inválido. Use MM/AAAA</div>
                            </div>
                            
                            <!-- Seleção do Tipo de Serviço -->
                            <div class="mb-3">
                                <label>Tipo de Serviço:</label><br>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="bot_path" id="servicosTomados" value="bot2.py" checked>
                                    <label class="form-check-label" for="servicosTomados">
                                        Serviços Tomados
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="bot_path" id="servicosPrestados" value="bot.py">
                                    <label class="form-check-label" for="servicosPrestados">
                                        Serviços Prestados
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Botão de Envio com Spinner -->
                            <button type="submit" class="btn btn-primary" id="submitButton">
                                <span class="btn-text">Encerrar Movimento</span>
                                <span class="spinner-border spinner-border-sm btn-spinner" role="status" aria-hidden="true" style="display: none;"></span>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    
    
    
    </div>
    <!-- Bootstrap Bundle com Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Socket.IO (versão cliente) -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    
</body>
</html>
